# DIGSHIBUYA 参加型寄付 💰

DIGSHIBUYAの一環で参加型寄付を実験するプロジェクトのドキュメントです。
詳細は、 https://donation.digshibuya.com をご覧ください。


このプロジェクトはOwockiが率いるSupermodulerチームが「Simple Grant」という名で開発されていたが、[頓挫](https://github.com/supermodularxyz/simplegrants)。[現在はGitcoinの下でWeb2 QFツールが開発されているが、途中。](https://github.com/gitcoinco/simplegrants.xyz) この状況により、~~DigDAO マッチングドネーション~~ （DIGSHIBUYA 参加型寄付）では元々のツールを使うことにした。

> [!NOTE]
> DIGSHIBUYA 参加型寄付プロジェクトは、simplegrant→DigDAOと使用されていたものをforkして利用しています。

## プロジェクトの目的 🎯
- Quadratic Funding（「参加型寄付」）をアーティスト支援として活用してみる
- 商業的な作品を作ることで資金を得る以外の方法を模索していく

## このプロジェクトについて ❓

DigDAOにて、インパクトファンディングプロジェクトを担当した[tkgshn](https://tkgshn.com)が進めています。

DIGSHIBUYAという実験的なアートフェスティバルを開催するので、資金分配の実験ができないかということで打診をもらいました。

Quadratic Funding（QF）はデジタル公共財に対して使われたケースが多い中、アーティスト・アートの資金的な持続可能性というテーマで進めるのはユニークだと考えています。QFは行政組織などが恣意性を持たずに助成金や補助金を分配する手段としても有効なので、文化事業で実験するのも面白いかなと思います。

## ソフトウェアアーキテクチャー 📄

- [バックエンド](./backend/)
- [フロントエンド](./frontend/)
- データベース（Postgres）

DIGSHIBUYA 参加型寄付では、renderにdeployをしています。

## このリポジトリの使い方 🛠

このリポジトリは`backend`および`frontend`の2つのフォルダに分かれており、フォルダ名は自己説明的です。セットアップ方法についての詳細は、各フォルダ内のREADMEをご覧ください！

## インストールとセットアップ 🧪

1. リポジトリをクローンする
2. `backend`フォルダに移動し、[Backend README](./backend/README.md)に記載されているインストールとセットアップの指示に従う。
3. `frontend`フォルダに移動し、[Frontend README](./frontend/README.md)に記載されているインストールとセットアップの指示に従う。

### ローカル開発 👨🏻‍💻

ローカル開発のためにサービスを実行したい場合は、以下の手順に従ってください。

1. まず、上記のように各フォルダのREADMEに記載されているとおりにすべてをインストールしセットアップします。まだサービスを実行する必要はありません。
2. 支払いプロバイダとしてStripeを使用している場合は、Stripe CLIがセットアップされ、すでにログインしていることを確認してください。
3. すべてがセットアップされたら、以下のコマンドを実行して必要なサービスをすぐに立ち上げます。

```bash
# フロントエンドとバックエンドの.envを適宜更新
# その後、全てをビルドして実行
# これにより、自動的にシード、マイグレーションが実行され、StripeのWebhookリスナーが起動します
$ npm run start:dev
```

### デプロイメント設定 🚀

このアプリケーションをデプロイしたい場合、プロセスを少し速めるのに役立つシンプルなスクリプトがあります。

1. まず、上記の各フォルダのREADMEに記載されているとおりに全てをインストールし、セットアップしてください。まだサービスを実行する必要はありません。
2. 全てがセットアップされたら、以下のコマンドを実行して必要なサービスを即座に立ち上げます。**注意: これは、複数のプラットフォームにホスティングするのではなく、Dockerを使用してすべてを一つのサーバーにデプロイすることを前提としています**。

```bash
# フロントエンドとバックエンドの.envを適宜更新
# その後、全てを一つのサーバーにデプロイ
# 必要に応じてシードとマイグレーションが自動的に実行されます
$ npm run start
```

3. 支払いプロバイダーのWebhookが適切に設定されていることを確認してください。
4. Dockerを使用しているため、コンテナ間で`localhost`を介して通信することができないことを覚えておくことが非常に重要です。これは、理想的にはNGINX（または使用しているリバースプロキシ）をサービスを指すように設定し、環境変数を正規のURLを使用するように変更することを意味します。
